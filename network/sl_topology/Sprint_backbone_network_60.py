# from turtle import delay
from re import S
from ipmininet.iptopo import IPTopo
from ipmininet.router.config import RouterConfig, STATIC, StaticRoute
from ipmininet.ipnet import IPNet
from ipmininet.cli import IPCLI

# 静态配置如下所示的网络拓扑 (Sprint backbone network)
# 25 nodes, 53 links.(50)
# By default, OSPF and OSPF6 are launched on each router.所以下面是采取这样的方式迭代更新路由表
class StaticRoutingNet(IPTopo):

    def build(self, *args, **kwargs):

        
        # 25 routers, 53links
        r1 = self.addRouter('r1', use_v4=True, use_v6=False, lo_addresses=["10.1.1.1/24"])
        r2 = self.addRouter("r2", use_v4=True, use_v6=False, lo_addresses=["10.2.1.1/24"])
        r3 = self.addRouter("r3", use_v4=True, use_v6=False, lo_addresses=["10.3.1.1/24"])
        r4 = self.addRouter("r4", use_v4=True, use_v6=False, lo_addresses=["10.4.1.1/24"])
        r5 = self.addRouter("r5", use_v4=True, use_v6=False, lo_addresses=["10.5.1.1/24"])
        r6 = self.addRouter("r6", use_v4=True, use_v6=False, lo_addresses=["10.6.1.1/24"])
        r7 = self.addRouter("r7", use_v4=True, use_v6=False, lo_addresses=["10.7.1.1/24"])
        r8 = self.addRouter("r8", use_v4=True, use_v6=False, lo_addresses=["10.8.1.1/24"])
        r9 = self.addRouter("r9", use_v4=True, use_v6=False, lo_addresses=["10.9.1.1/24"])
        r10 = self.addRouter("r10", use_v4=True, use_v6=False, lo_addresses=["10.10.1.1/24"])
        r11 = self.addRouter("r11", use_v4=True, use_v6=False, lo_addresses=["10.11.1.1/24"])
        r12 = self.addRouter("r12", use_v4=True, use_v6=False, lo_addresses=["10.12.1.1/24"])
        r13 = self.addRouter("r13", use_v4=True, use_v6=False, lo_addresses=["10.13.1.1/24"])
        r14 = self.addRouter("r14", use_v4=True, use_v6=False, lo_addresses=["10.14.1.1/24"])
        r15 = self.addRouter("r15", use_v4=True, use_v6=False, lo_addresses=["10.15.1.1/24"])
        r16 = self.addRouter("r16", use_v4=True, use_v6=False, lo_addresses=["10.16.1.1/24"])
        r17 = self.addRouter("r17", use_v4=True, use_v6=False, lo_addresses=["10.17.1.1/24"])
        r18 = self.addRouter("r18", use_v4=True, use_v6=False, lo_addresses=["10.18.1.1/24"])
        r19 = self.addRouter("r19", use_v4=True, use_v6=False, lo_addresses=["10.19.1.1/24"])
        r20 = self.addRouter("r20", use_v4=True, use_v6=False, lo_addresses=["10.20.1.1/24"])
        r21 = self.addRouter("r21", use_v4=True, use_v6=False, lo_addresses=["10.21.1.1/24"])
        r22 = self.addRouter("r22", use_v4=True, use_v6=False, lo_addresses=["10.22.1.1/24"])
        r23 = self.addRouter("r23", use_v4=True, use_v6=False, lo_addresses=["10.23.1.1/24"])
        r24 = self.addRouter("r24", use_v4=True, use_v6=False, lo_addresses=["10.24.1.1/24"])
        r25 = self.addRouter("r25", use_v4=True, use_v6=False, lo_addresses=["10.25.1.1/24"])
        listr = [r1,r2,r3,r4,r5,r6,r7,r8,r9,r10,r11,r12,r13,r14,r15,r16,r17,r18,r19,r20,r21,r22,r23,r24,r25]

        # 53条links，需要53个子网
        # 经过仔细的数，只数到50条links，需要50个子网
        # 添加延时:delay="?ms",添加带宽bw=100
        lr1r2 = self.addLink(r1, r2, delay = "17ms", bw=60)
        self.addSubnet(links=[lr1r2], subnets=["10.53.1.0/24"])
        lr1r8 = self.addLink(r1, r8, delay = "48ms", bw=60)
        self.addSubnet(links=[lr1r8], subnets=["10.53.2.0/24"])
        lr1r6 = self.addLink(r1, r6, delay = "27ms", bw=60)
        self.addSubnet(links=[lr1r6], subnets=["10.53.3.0/24"])
        lr1r13 = self.addLink(r1, r13, delay = "44ms", bw=60)
        self.addSubnet(links=[lr1r13], subnets=["10.53.4.0/24"])
        lr2r3 = self.addLink(r2, r3, delay = "5ms", bw=60)
        self.addSubnet(links=[lr2r3], subnets=["10.53.5.0/24"])
        lr2r4 = self.addLink(r2, r4, delay = "9ms", bw=60)
        self.addSubnet(links=[lr2r4], subnets=["10.53.6.0/24"])
        lr2r6 = self.addLink(r2, r6, delay = "23ms", bw=60)
        self.addSubnet(links=[lr2r6], subnets=["10.53.7.0/24"])
        lr2r9 = self.addLink(r2, r9, delay = "34ms", bw=60)
        self.addSubnet(links=[lr2r9], subnets=["10.53.8.0/24"])
        lr3r4 = self.addLink(r3, r4, delay = "11ms", bw=60)
        self.addSubnet(links=[lr3r4], subnets=["10.53.9.0/24"])
        lr4r5 = self.addLink(r4, r5, delay = "10ms", bw=60)
        self.addSubnet(links=[lr4r5], subnets=["10.53.10.0/24"])
        lr4r11 = self.addLink(r4, r11, delay = "26ms", bw=60)
        self.addSubnet(links=[lr4r11], subnets=["10.53.11.0/24"])
        lr5r11 = self.addLink(r5, r11, delay = "21ms", bw=60)
        self.addSubnet(links=[lr5r11], subnets=["10.53.12.0/24"])
        lr5r6 = self.addLink(r5, r6, delay = "28ms", bw=60)
        self.addSubnet(links=[lr5r6], subnets=["10.53.13.0/24"])
        lr6r7 = self.addLink(r6, r7, delay = "3ms", bw=60)
        self.addSubnet(links=[lr6r7], subnets=["10.53.14.0/24"])
        lr6r9 = self.addLink(r6, r9, delay = "10ms", bw=60)
        self.addSubnet(links=[lr6r9], subnets=["10.53.15.0/24"])
        lr7r11 = self.addLink(r7, r11, delay = "24ms", bw=60)
        self.addSubnet(links=[lr7r11], subnets=["10.53.16.0/24"])
        lr8r9 = self.addLink(r8, r9, delay = "9ms", bw=60)
        self.addSubnet(links=[lr8r9], subnets=["10.53.17.0/24"])
        lr8r13 = self.addLink(r8, r13, delay = "8ms", bw=60)
        self.addSubnet(links=[lr8r13], subnets=["10.53.18.0/24"])
        lr9r13 = self.addLink(r9, r13, delay = "9ms", bw=60)
        self.addSubnet(links=[lr9r13], subnets=["10.53.19.0/24"])
        lr9r10 = self.addLink(r9, r10, delay = "4ms", bw=60)
        self.addSubnet(links=[lr9r10], subnets=["10.53.20.0/24"])
        lr10r11 = self.addLink(r10, r11, delay = "11ms", bw=60)
        self.addSubnet(links=[lr10r11], subnets=["10.53.21.0/24"])
        lr10r13 = self.addLink(r10, r13, delay = "11ms", bw=60)
        self.addSubnet(links=[lr10r13], subnets=["10.53.22.0/24"]) 
        lr10r14 = self.addLink(r10, r14, delay = "4ms", bw=60)
        self.addSubnet(links=[lr10r14], subnets=["10.53.23.0/24"])
        lr10r16 = self.addLink(r10, r16, delay = "16ms", bw=60)
        self.addSubnet(links=[lr10r16], subnets=["10.53.24.0/24"])
        lr11r12 = self.addLink(r11, r12, delay = "6ms", bw=60)
        self.addSubnet(links=[lr11r12], subnets=["10.53.25.0/24"])
        lr11r13 = self.addLink(r11, r13, delay = "21ms", bw=60)
        self.addSubnet(links=[lr11r13], subnets=["10.53.26.0/24"])
        lr11r16 = self.addLink(r11, r16, delay = "20ms", bw=60)
        self.addSubnet(links=[lr11r16], subnets=["10.53.27.0/24"])
        lr11r19 = self.addLink(r11, r19, delay = "17ms", bw=60)
        self.addSubnet(links=[lr11r19], subnets=["10.53.28.0/24"])
        lr11r22 = self.addLink(r11, r22, delay = "35ms", bw=60)
        self.addSubnet(links=[lr11r22], subnets=["10.53.29.0/24"])
        lr12r22 = self.addLink(r12, r22, delay = "28ms", bw=60)
        self.addSubnet(links=[lr12r22], subnets=["10.53.30.0/24"])
        lr13r14 = self.addLink(r13, r14, delay = "9ms", bw=60)
        self.addSubnet(links=[lr13r14], subnets=["10.53.31.0/24"])
        lr13r15 = self.addLink(r13, r15, delay = "8ms", bw=60)
        self.addSubnet(links=[lr13r15], subnets=["10.53.32.0/24"])
        lr13r17 = self.addLink(r13, r17, delay = "7ms", bw=60)
        self.addSubnet(links=[lr13r17], subnets=["10.53.33.0/24"])
        lr13r18 = self.addLink(r13, r18, delay = "7ms", bw=60)
        self.addSubnet(links=[lr13r18], subnets=["10.53.34.0/24"])
        lr15r18 = self.addLink(r15, r18, delay = "8ms", bw=60)
        self.addSubnet(links=[lr15r18], subnets=["10.53.35.0/24"])
        lr15r16 = self.addLink(r15, r16, delay = "6ms", bw=60)
        self.addSubnet(links=[lr15r16], subnets=["10.53.36.0/24"])
        lr16r25 = self.addLink(r16, r25, delay = "18ms", bw=60)
        self.addSubnet(links=[lr16r25], subnets=["10.53.37.0/24"])
        lr16r19 = self.addLink(r16, r19, delay = "6ms", bw=60)
        self.addSubnet(links=[lr16r19], subnets=["10.53.38.0/24"])
        lr17r18 = self.addLink(r17, r18, delay = "4ms", bw=60)
        self.addSubnet(links=[lr17r18], subnets=["10.53.39.0/24"])
        lr18r23 = self.addLink(r18, r23, delay = "13ms", bw=60)
        self.addSubnet(links=[lr18r23], subnets=["10.53.40.0/24"])
        lr18r24 = self.addLink(r18, r24, delay = "9ms", bw=60)
        self.addSubnet(links=[lr18r24], subnets=["10.53.41.0/24"])
        lr18r25 = self.addLink(r18, r25, delay = "9ms", bw=60)
        self.addSubnet(links=[lr18r25], subnets=["10.53.42.0/24"])
        lr19r20 = self.addLink(r19, r20, delay = "4ms", bw=60)
        self.addSubnet(links=[lr19r20], subnets=["10.53.43.0/24"])
        lr19r22 = self.addLink(r19, r22, delay = "22ms", bw=60)
        self.addSubnet(links=[lr19r22], subnets=["10.53.44.0/24"])
        lr20r21 = self.addLink(r20, r21, delay = "7ms", bw=60)
        self.addSubnet(links=[lr20r21], subnets=["10.53.45.0/24"])
        lr20r22 = self.addLink(r20, r22, delay = "14ms", bw=60)
        self.addSubnet(links=[lr20r22], subnets=["10.53.46.0/24"])
        lr20r25 = self.addLink(r20, r25, delay = "11ms", bw=60)
        self.addSubnet(links=[lr20r25], subnets=["10.53.47.0/24"])
        lr21r22 = self.addLink(r21, r22, delay = "4ms", bw=60)
        self.addSubnet(links=[lr21r22], subnets=["10.53.48.0/24"])
        lr23r24 = self.addLink(r23, r24, delay = "6ms", bw=60)
        self.addSubnet(links=[lr23r24], subnets=["10.53.49.0/24"])
        lr24r25 = self.addLink(r24, r25, delay = "8ms", bw=60)
        self.addSubnet(links=[lr24r25], subnets=["10.53.50.0/24"])

        # 建立25个主机，ri -- hi，测试连通性
        h1 = self.addHost("h1")
        h2 = self.addHost("h2")
        h3 = self.addHost("h3")
        h4 = self.addHost("h4")
        h5 = self.addHost("h5")
        h6 = self.addHost("h6")
        h7 = self.addHost("h7")
        h8 = self.addHost("h8")
        h9 = self.addHost("h9")
        h10 = self.addHost("h10")
        h11 = self.addHost("h11")
        h12 = self.addHost("h12")
        h13 = self.addHost("h13")
        h14 = self.addHost("h14")
        h15 = self.addHost("h15")
        h16 = self.addHost("h16")
        h17 = self.addHost("h17")
        h18 = self.addHost("h18")
        h19 = self.addHost("h19")
        h20 = self.addHost("h20")
        h21 = self.addHost("h21")
        h22 = self.addHost("h22")
        h23 = self.addHost("h23")
        h24 = self.addHost("h24")
        h25 = self.addHost("h25")
        listh = [h1, h2, h3, h4, h5, h6, h7, h8, h9, h10, h11, h12, h13, h14, h15, h16, h17, h18, h19, h20, h21, h22,
                 h23, h24, h25]
        i = 1
        while i <= 25:
            self.addLink(listh[i-1], listr[i-1], delay = "0ms")
            self.addSubnet(nodes=[listr[i-1], listh[i-1]],subnets=["192.10."+str(i)+".0/24"])
            i += 1
        super().build(*args, **kwargs)


net = IPNet(topo=StaticRoutingNet(),use_v6=False)
try:
    net.start()
    IPCLI(net)
finally:
    net.stop()